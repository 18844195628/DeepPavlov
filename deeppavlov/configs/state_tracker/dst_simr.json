{
  "dataset_reader": {
    "name": "sim_r_reader",
    "data_path": "google-dialogues"
  },
  "dataset_iterator": {
    "name": "dialog_state_iterator"
  },
  "chainer": {
    "in": ["u_utter", "u_slots", "u_slots_bio", "u_acts", "s_tokens", "s_slots", "s_slots_bio", "s_acts", "prev_state"],
    "in_y": ["state"],
    "out": ["state_pred"],
    "pipe": [
      {
        "name": "action_vocab",
        "id": "system_action_vocab",
        "load_path": "dst/system_actions.dict",
        "save_path": "dst/system_actions.dict",
        "special_tokens": ["unknown"],
        "default_token": "unknown",
        "fit_on": ["s_acts"],
        "in": ["s_acts"],
        "out": ["s_act_idx"]
      },
      {
        "name": "action_vocab",
        "id": "user_action_vocab",
        "load_path": "dst/user_actions.dict",
        "save_path": "dst/user_actions.dict",
        "special_tokens": ["unknown"],
        "default_token": "unknown",
        "fit_on": ["u_acts"],
        "in": ["u_acts"],
        "out": ["u_act_idx"]
      },
      {
        "name": "simple_vocab",
        "id": "slot_vocab",
        "save_path": "dst/slot_names.dict",
        "fit_on": ["state"]
      },
      {
        "name": "lazy_tokenizer",
        "in": ["u_utter"],
        "out": ["u_tokens"]
      },
      {
        "class": "deeppavlov.models.state_tracker.preprocessors:Delexicalizator",
        "in": ["u_tokens", "u_slots_bio"],
        "out": ["u_norm_tokens"]
      },
      {
        "class": "deeppavlov.models.state_tracker.preprocessors:Delexicalizator",
        "in": ["s_tokens", "s_slots_bio"],
        "out": ["s_norm_tokens"]
      },
      {
        "name": "simple_vocab",
        "id": "word_vocab",
        "save_path": "dst/word.dict",
        "load_path": "dst/word.dict",
        "fit_on": ["u_norm_tokens", "s_norm_tokens"],
        "special_tokens": ["<unk>"],
        "in": ["u_norm_tokens"],
        "out": ["u_tok_idx"]
      },
      {
        "ref": "word_vocab",
        "in": ["s_norm_tokens"],
        "out": ["s_tok_idx"]
      },
      {
        "name": "emb_mat_assembler",
        "id": "embeddings",
        "embedder": {
          "name": "glove",
          "load_path": "embeddings/glove.6B.100d.txt"
        },
        "vocab": "#word_vocab" 
      },
      {
        "name": "slot_value_filter",
        "id": "slot_filter",
        "max_num_values": 7,
        "exclude_values": ["dontcare"],
        "in": ["u_slots", "s_slots", "prev_state"],
        "out": ["slot_candidates"]
      },
      {
        "class": "deeppavlov.models.state_tracker.candidates:CandidateIndexerBuilder",
        "special_values": ["null", "dontcare"],
        "in": ["slot_candidates"],
        "out": ["slot_cand_indexer"]
      },
      {
        "class": "deeppavlov.models.state_tracker.preprocessors:SlotsTokensMatrixBuilder",
        "slot_vocab": "#slot_vocab",
        "in": ["u_tokens", "u_slots_bio", "slot_cand_indexer"],
        "out": ["u_tok_slot_idx_matr"]
      },
      {
        "class": "deeppavlov.models.state_tracker.preprocessors:SlotsTokensMatrixBuilder",
        "slot_vocab": "#slot_vocab",
        "in": ["s_tokens", "s_slots_bio", "slot_cand_indexer"],
        "out": ["s_tok_slot_idx_matr"]
      },
      {
        "class": "deeppavlov.models.state_tracker.preprocessors:SlotsValuesMatrixBuilder",
        "slot_vocab": "#slot_vocab",
        "max_num_values": "#slot_filter.max_num_values",
        "in": ["state", "slot_cand_indexer"],
        "out": ["state_matr"]
      },
      {
        "class": "deeppavlov.models.state_tracker.preprocessors:SlotsValuesMatrixBuilder",
        "slot_vocab": "#slot_vocab",
        "max_num_values": "#slot_filter.max_num_values",
        "in": ["prev_state", "slot_cand_indexer"],
        "out": ["prev_state_matr"]
      },
      {
        "name": "dst_network",
        "load_path": "dst/model",
        "save_path": "dst/model",
        "in": ["u_tok_idx", "u_tok_slot_idx_matr", "s_tok_idx", "s_tok_slot_idx_matr",
          "prev_state_matr"],
        "in_y": ["state_matr"],
        "out": ["state_pred_matr"],
        "hidden_size": 128,
        "dense_size": 32,
        "num_slot_values": "#slot_filter.max_num_values",
        "embedding_matrix": "#embeddings.emb_mat",
        "learning_rate": 0.0031
      },
      {
        "class": "deeppavlov.models.state_tracker.preprocessors:SlotsValuesMatrix2Dict",
        "slot_vocab": "#slot_vocab",
        "exclude_values": ["null"],
        "in": ["state_pred_matr", "slot_cand_indexer"],
        "out": ["state_pred"]
      }
    ]
  },
  "train": {
    "epochs": 100,
    "batch_size": 1,

    "metrics": ["accuracy"],
    "validation_patience": 10,
    "val_every_n_epochs": 1,

    "log_every_n_epochs": 1,
    "tensorboard_log_dir": "logs"
  },
  "metadata": {
    "requirements": [
      "../dp_requirements/tf.txt"
    ],
    "labels": {
    },
    "download": [
      {
        "url": "http://files.deeppavlov.ai/embeddings/glove.6B.100d.txt",
        "subdir": "embeddings"
      }
    ]
  }
}
